<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="styles.css">
<title>Scan Prescription</title>
<!-- Bootstrap files -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
<link  href="node_modules/cropperjs/dist/cropper.css" rel="stylesheet">
<script src="node_modules/cropperjs/dist/cropper.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="page2"  style="color: white;">

	<div class="container">
		<div class="alert alert-default mt-4" style="height: 3rem;color: wheat;">
			<div class="row">
				<div class="col text-left">
					<p><strong>Hii Youngman</strong></p>
				</div>
				<div class="col text-right">
					<a class="btn" onclick="page1()"><strong>Back</strong></a>
				</div>
			</div>
		</div>
<!-- 		<p class="center"><strong>Medicines requested from</strong></p>
 -->		<form><strong>
			<div class="form-group">
				<div class="row">
					<div class="col-md-6">
						<label for="name">Name of the Medical Shop</label>
						<input type="text" name="name" placeholder="Medgreen Pharmacy" readonly required class="form-control mb-2">
						<small id="nameHelp" class="form-text text-white mb-2">Drugstore chain with health & beauty items, plus first-aid supplies & some household products.</small>
					</div>
					<div class="col-md-3">
						<label for="mail">Email Id</label>
						<input type="mail" name="mail" placeholder="medgreencare@gmail.com" readonly required class="form-control mb-2">
					</div>
					<div class="col-md-3">
						<label for="mail">Website</label>
						<input type="text" name="web" placeholder="www.medgreens.com" readonly required class="form-control mb-2">
					</div>
				</div>

				<label for="address">Location</label>
				<input type="text" name="address" placeholder=" 2nd Main Road, Kottur Gardens, Adyar House, Kotturpuram, Chennai, Tamil Nadu 600085" readonly required class="form-control mb-2">

				<div class="row">
					<div class="col-md-6">
						<label for="city">City</label>
						<input type="text" name="city" placeholder="Chennai" readonly required class="form-control mb-2">
					</div>
					<div class="col-md-6">
						<label for="state">State</label>
						<input type="text" name="state" placeholder="Tamilnadu" readonly required class="form-control mb-2">
					</div>
				</div>
				

				<div class="row">
					<div class="col-md-8">
						<label for="hours">Pharmacy Hours</label>
						<select class="form-control mb-2" readonly>
							<option>Sunday 9.00 AM - 6.00 PM</option>
							<option>Monday 9.00 AM -10.30 PM</option>
							<option>Tuesday 9.00 AM - 10.30 PM</option>
							<option>Wednesday 9.00 AM - 10.30 PM</option>
							<option>Thursday 9.00 AM - 10.30 PM</option>
							<option>Friday 9.00 AM - 10.30 PM</option>
							<option>Saturday 9.00 AM -10.30 PM</option>
						</select>
					</div>
					<div class="col-md-4">
						<label for="phone">Mobile No</label>
						<input type="numbe2" name="mobile" placeholder="9963421022" readonly required class="form-control mb-2">
					</div>
				</div>

				<div class="row mt-2">
					<div class="col-md-8">
						<div class="checkbox">
					    	<label><input type="checkbox"> I understand and accept the terms and conditions.</label>
					  	</div>
					</div>
					<div class="col-md-4">
					    <label for="files" class="btn btn-default form-control btn-dark">Scan Prescription</label>
     					 <input id="files" style="visibility:hidden;" type="file" name="image" accept="image/*" capture="environment">
					</div>
				</div>
			</div></strong>
		</form>
	</div>
	<p class="container"  id="picEdit" style="visibility: hidden;">
		<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" id="btnCrop">Crop</button>
		<button type="button" class="btn btn-info btn-lg" id="btnRestore">Reset</button>
	</p>

	<!-- <button type="button" class="btn btn-info" onclick="showimage()">show</button> -->
	<!-- <div id="check"></div> -->

	<div class="container img-fluid" alt="Responsive image">
		 <canvas id="canvas" class="mr-5"></canvas>
	</div>
	
	<!--popup to show image -->
	<div id="myModal" class="modal fade text-dark" role="dialog">
	  <div class="modal-dialog">

	    <!-- Modal content-->
	    <div class="modal-content">
	      <div class="modal-header">
	        <h4 class="modal-title">Cropped Image</h4>
	      </div>
	      <div class="modal-body text-info">
	        <p><strong>click proceed button to send the prescription</strong></p>
	        <div id="result" class="m-5"></div>
	      </div>
	      <div class="modal-footer">
	      	<button type="button" class="btn btn-info" onclick="UploadPrescription()">Proceed</button>
	        <button type="button" class="btn btn-danger" data-dismiss="modal">Abort</button>
	      </div>
	    </div>

	  </div>
	</div>

	<!-- <footer class="footer_bg">
		<div class="row">
			<div class="col-md-2">
				<div class="text-left" style="margin-left: 2rem">Â© 2018 WeCareYou</div>
			</div>
			<div class="col-md-10">
				<div class="text-right" style="margin-right: 2rem">Contact us: support@wecareyou.com</div>
			</div>
		</div>
	</footer> -->
	
	<!--Script-->

	<script type="text/javascript">
		var canvas  = $("#canvas"),
	    context = canvas.get(0).getContext("2d"),
	    $result = $('#result');
	    var input = document.querySelector('input[type=file]');
	    console.log(input.files[0]);
  		input.onchange = function () {
		    if (this.files && this.files[0]) {
		      if ( this.files[0].type.match(/^image\//) ) {
		        var reader = new FileReader();
		        reader.onload = function(evt) {
		           var img = new Image();
		           img.onload = function() {
		             context.canvas.height = img.height;
		             context.canvas.width  = img.width;
		             context.drawImage(img, 0, 0);

					document.getElementById("picEdit").style.visibility="visible";
		            var image = document.getElementById('canvas');
		            var cropper = new Cropper(image, {
				        aspectRatio: 1 / 1,
				        setDragMode: "move"
				      });
		            // cropper.rotateTo(180);
		            // setDragMode("move");



		     
		             $('#btnCrop').click(function() {
		                croppedImageDataURL =  cropper.getCroppedCanvas().toDataURL();
		                console.log(croppedImageDataURL);
		                $result.append( $('<img>').attr('src', croppedImageDataURL) );
		             });
		             $('#btnRestore').click(function() {	
		               $result.empty();
		             });
		           };
		           img.src = evt.target.result;
						};
		        reader.readAsDataURL(this.files[0]);
		      }
		      else {
		        alert("Invalid file type! Please select an image file.");
		      }
		    }
		    else {
		      alert('No file(s) selected.');
		    }
		};

		function page1(){
			location.href="home.html";
		}

		function takePhoto(){

		}

		// Api call

		function UploadPrescription() {

		  	var url = 'http://localhost:3000/prescriptions#create';
			var data = {name: "example", mobileNo: "977232323", medical_sheet: croppedImageDataURL};
			var formData = new FormData();
			// $result = $('#result');
			formData.append('name', 'inba');
			formData.append('mobileNo', '9043595542');
			formData.append('photo', input.files[0]);
			formData.append('url', croppedImageDataURL)
			fetch(url, {
			  method: 'POST', // or 'PUT'
			  body: formData // data can be `string` or {object}!
			  // headers:{
			  //   'Content-Type': 'multipart/form-data'
			  // }
			})
			.then(response => response.json())
			.catch(error => console.error('Error:', error))
			.then(response => console.log('Success:', JSON.stringify(response)));

		}

		function showimage(){
			var url = 'http://localhost:3000/prescriptions#show';
			fetch(url)
			.then((res) => { return res.json() })
			.then((data) => {
				console.log(data.url)
            $('#check').append( $('<img>').attr('src', data.url))
        });

		}


			
			

	</script>
</body>
</html>